<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Team Dashboard — Dashboard Clone</title>

  <!-- Chart.js & CSV parser -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    /* ==== Global Reset and Basics ==== */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f4f7fc; color: #333; }
    a { text-decoration: none; color: inherit; }

    /* ==== Header / Navbar ==== */
    header { background: linear-gradient(135deg, #0066ff, #0099ff); padding: 1.8rem 1rem; color: white; text-align: center; }
    header h1 { font-size: 1.9rem; margin-bottom: 0.3rem; }
    header p { font-size: 1rem; opacity: 0.9; }

    /* ==== Container ==== */
    .container { max-width: 1000px; margin: 2rem auto; padding: 0 1rem; }

    /* ==== Cards ==== */
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }
    .card { background: white; border-radius: 10px; padding: 1.2rem; box-shadow: 0 4px 16px rgba(0,0,0,0.08); text-align: center; }
    .card h3 { font-size: 2rem; color: #0066ff; margin-bottom: 0.3rem; }
    .card p { font-size: 0.95rem; color: #555; }

    /* ==== Filter & Controls ==== */
    #controls { text-align: center; margin: 1.5rem 0; }
    #monthFilter { padding: 8px 12px; border: 1px solid #ccc; border-radius: 8px; }

    /* ==== Table ==== */
    .table-wrapper { margin-top: 2rem; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
    th, td { padding: 12px 10px; text-align: center; }
    th { background: #0066ff; color: white; }
    tr:nth-child(even) { background: #f9fbff; }
    tr:hover { background: #eef5ff; }
    td.name-cell { color: #0066ff; cursor: pointer; text-decoration: underline; }

    /* ==== Chart Container ==== */
    .chart-container { background: white; padding: 1.2rem; border-radius: 8px; box-shadow: 0 4px 16px rgba(0,0,0,0.08); margin-top: 2rem; }

    /* ==== Profile Card ==== */
    #profileCard { display: none; background: white; border-radius: 10px; padding: 1rem; box-shadow: 0 4px 16px rgba(0,0,0,0.08); margin-top: 1.5rem; }
    #profileCard .avatar {
      width: 50px; height: 50px; border-radius: 50%;
      background: #0066ff; color: white;
      display: flex; align-items: center; justify-content: center;
      font-size: 1.3rem; font-weight: bold; margin-right: 1rem;
    }
    #profileCard .info { display: inline-block; vertical-align: middle; }
    #profileCard .info h4 { margin-bottom: 0.2rem; }
    #profileCard .info p { font-size: 0.9rem; color: #555; }

    /* ==== Back Button ==== */
    #backBtn { display: none; margin: 1rem auto; padding: 8px 18px; background: #0066ff; color: white; border: none; border-radius: 6px; cursor: pointer; }

  </style>
</head>
<body>

  <header>
    <h1>Team Dashboard</h1>
    <p>Monthly Performance & Hours</p>
  </header>

  <div class="container">

    <div id="controls">
      <label for="monthFilter">Select Month: </label>
      <select id="monthFilter"><option value="All">All</option></select>
    </div>

    <div class="cards">
      <div class="card"><h3 id="totalHours">0h</h3><p>Total Hours</p></div>
      <div class="card"><h3 id="avgPerf">0%</h3><p>Average Performance</p></div>
      <div class="card"><h3 id="teamCount">0</h3><p>Team Members</p></div>
      <div class="card"><h3 id="topPerformer">-</h3><p>Top Performer</p></div>
    </div>

    <div class="table-wrapper">
      <table id="teamTable">
        <thead>
          <tr><th>Name</th><th>Hours</th><th>Performance %</th><th>Remarks</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <button id="backBtn">← Back to Full Team</button>

    <div id="profileCard">
      <div style="display:flex; align-items:center;">
        <div class="avatar" id="avatarCircle">A</div>
        <div class="info">
          <h4 id="profileName">Name</h4>
          <p id="profileRemarks">Remarks: -</p>
          <p id="profileMonth">Month: -</p>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <canvas id="mainChart"></canvas>
    </div>

  </div>

  <script>
    let dataAll = [], perfKey = "Performance";

    function loadCSV() {
      Papa.parse("team_report.csv", { download: true, header: true, skipEmptyLines: true,
        complete: function(res) {
          dataAll = res.data.map(r => {
            const o = {};
            for (let k in r) if (k) o[k.trim()] = (r[k] || "").trim();
            return o;
          });
          detectPerfKey();
          populateMonths();
          updateView();
        }
      });
    }

    function detectPerfKey(){
      const keys = Object.keys(dataAll[0] || {});
      const k = keys.find(k => k.toLowerCase().startsWith("perform"));
      if (k) perfKey = k;
    }

    function populateMonths(){
      const sel = document.getElementById("monthFilter");
      const months = [... new Set(dataAll.map(r => (r.Month || "").trim()).filter(m=> m))];
      months.forEach(m=>{
        const opt = document.createElement("option");
        opt.value = m; opt.textContent = m;
        sel.append(opt);
      });
      sel.onchange = updateView;
    }

    function updateView(){
      const month = document.getElementById("monthFilter").value;
      const filtered = month === "All" ? dataAll : dataAll.filter(r => (r.Month||"").trim() === month);
      if (!filtered.length) return;

      // Stats
      const totHours = filtered.reduce((s,r)=> s + (parseFloat(r.Hours)||0), 0);
      const avg = filtered.reduce((s,r)=> s + (parseFloat(r[perfKey])||0), 0) / filtered.length;
      const top = filtered.reduce((a,b)=> (parseFloat(a[perfKey])||0) > (parseFloat(b[perfKey])||0) ? a : b, {});

      document.getElementById("totalHours").innerText = totHours.toFixed(1) + " h";
      document.getElementById("avgPerf").innerText = isNaN(avg)? "0%" : avg.toFixed(1)+" %";
      document.getElementById("teamCount").innerText = filtered.length;
      const tn = top.Name || "-"; const tp = parseFloat(top[perfKey])||0;
      document.getElementById("topPerformer").innerText = tn === "-" ? "-" : (tn + " — " + tp + "%");

      renderTable(filtered);
      renderChart(filtered);
      hideProfile();
    }

    function renderTable(rows){
      const tbody = document.querySelector("#teamTable tbody");
      tbody.innerHTML = "";
      rows.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="name-cell">${r.Name}</td>
          <td>${r.Hours}</td>
          <td>${r[perfKey] || 0}</td>
          <td>${r.Remarks || ""}</td>
        `;
        tr.querySelector(".name-cell").onclick = ()=> showIndividual(r);
        tbody.append(tr);
      });
    }

    let chart = null;
    function renderChart(rows){
      const ctx = document.getElementById("mainChart").getContext("2d");
      const labs = rows.map(r=> r.Name);
      const hrs = rows.map(r=> parseFloat(r.Hours)||0);
      const perf = rows.map(r=> parseFloat(r[perfKey])||0);

      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        data: {
          labels: labs,
          datasets: [
            { label: "Hours", type: "bar", data: hrs, backgroundColor:"#0066ff" },
            { label: "Performance %", type: "line", data: perf, borderColor:"#ffa500", borderWidth:2, fill:false }
          ]
        },
        options: { responsive: true, plugins: { legend:{ position:"bottom" } } }
      });
    }

    function showIndividual(r){
      document.getElementById("controls").scrollIntoView({ behavior: "smooth" });
      document.getElementById("backBtn").style.display = "block";
      const avatar = document.getElementById("avatarCircle");
      avatar.innerText = (r.Name||"")[0] || "?";
      document.getElementById("profileName").innerText = r.Name;
      document.getElementById("profileRemarks").innerText = "Remarks: " + (r.Remarks||"");
      document.getElementById("profileMonth").innerText = "Month: " + (r.Month||"");
      document.getElementById("profileCard").style.display = "block";

      const ctx = document.getElementById("mainChart").getContext("2d");
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        data: {
          labels:["Hours","Performance %"],
          datasets:[
            { label:"Hours", type:"bar", data:[ parseFloat(r.Hours)||0, 0 ], backgroundColor:"#0066ff" },
            { label:"Performance %", type:"line", data:[ 0, parseFloat(r[perfKey])||0 ], borderColor:"#ffa500", borderWidth:2, fill:false }
          ]
        },
        options:{ responsive:true, plugins:{ legend:{ position:"bottom" }, title:{ display:true, text: r.Name + " — Individual Report" }} }
      });
    }

    document.getElementById("backBtn").onclick = () => {
      document.getElementById("backBtn").style.display = "none";
      hideProfile();
      updateView();
    };

    function hideProfile(){
      document.getElementById("profileCard").style.display = "none";
    }

    // On load
    loadCSV();
  </script>

</body>
</html>
